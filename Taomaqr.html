<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    
    <title>Thế Giới QR</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #0d6efd; --text: #333; --bg: #f4f6f8; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            /* Quan trọng: Tạo khoảng trống cho Header và Footer cố định */
            padding-top: 60px;    /* Chiều cao Header */
            padding-bottom: 50px; /* Chiều cao Footer */
            min-height: 100vh;
            /* Chống kéo trang trên iOS để tạo cảm giác App */
            overscroll-behavior-y: none; 
        }

        .hidden { display: none !important; }

        /* --- 1. HEADER (CỐ ĐỊNH TRÊN CÙNG) --- */
        .app-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #eee;
            z-index: 1050; /* Cao hơn nội dung */
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .header-col-1, .header-col-3 { width: 40px; display: flex; align-items: center; justify-content: center; }
        .header-col-2 { flex: 1; text-align: center; font-weight: 800; color: var(--primary); font-size: 1.1rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .icon-btn { border: none; background: none; font-size: 1.3rem; color: #555; padding: 5px; }

        /* --- 2. CONTENT (CUỘN Ở GIỮA) --- */
        .app-content {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        /* Banner */
        .banner-area {
            width: 100%;
            height: 180px;
            background: #e9ecef;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .banner-img { width: 100%; height: 100%; object-fit: cover; }
        .vip-hide-banner { display: none !important; }

        /* QR Info Card */
        .qr-card {
            background: white;
            margin: 0;
            padding: 25px 20px;
            border-bottom: 1px solid #eee;
        }
        .qr-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: #222; }
        .qr-desc { color: #555; font-size: 0.95rem; line-height: 1.6; margin-bottom: 25px; white-space: pre-line; }
        
        /* Buttons */
        .action-btn {
            display: flex; align-items: center; justify-content: center;
            width: 100%; padding: 14px; border-radius: 50px;
            text-decoration: none; font-weight: 600; margin-bottom: 15px;
            transition: all 0.2s; font-size: 1rem;
        }
        .action-btn:active { transform: scale(0.98); }
        .btn-access { background: #28a745; color: white; border: none; box-shadow: 0 4px 15px rgba(40,167,69,0.3); }
        .btn-msg { background: #fff; color: var(--primary); border: 2px solid var(--primary); }

        /* Rating */
        .rating-area { text-align: center; margin-top: 10px; padding: 15px; background: white; margin-bottom: 20px; }
        .star-icon { color: #e0e0e0; font-size: 1.8rem; margin: 0 5px; cursor: pointer; }
        .star-icon.active { color: #ffc107; }

        /* --- 3. FOOTER (CỐ ĐỊNH DƯỚI ĐÁY) --- */
        .app-footer {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 50px;
            background: #fff;
            border-top: 1px solid #eee;
            display: flex; align-items: center; justify-content: center;
            z-index: 1050;
            color: #999; font-size: 0.75rem;
            /* Đảm bảo không bị che bởi thanh điều hướng iPhone */
            padding-bottom: env(safe-area-inset-bottom);
            height: calc(50px + env(safe-area-inset-bottom));
        }

        /* --- ADMIN STYLES --- */
        .admin-container { padding: 20px; }
        .sidebar-menu { width: 280px; }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1100; display: flex; justify-content: center; align-items: center; flex-direction: column;}
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner-border text-primary mb-3"></div>
        <small class="text-muted fw-bold">THEGIOIQR.NET</small>
    </div>

    <div class="offcanvas offcanvas-start sidebar-menu" tabindex="-1" id="sidebarMenu">
        <div class="offcanvas-header bg-light">
            <h5 class="offcanvas-title text-primary fw-bold">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="guest-menu">
                <button class="btn btn-primary w-100 mb-3 shadow-sm" onclick="showAuth()">
                    <i class="fas fa-user-shield me-2"></i> Đăng nhập Quản trị
                </button>
                <div class="text-center text-muted small px-3">
                    Đăng nhập để tạo mã QR, quản lý tài liệu và xem tin nhắn từ học viên.
                </div>
            </div>
            <div id="user-menu" class="hidden">
                <div class="d-flex align-items-center mb-4 p-3 bg-light rounded">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width:45px; height:45px; font-size: 1.2rem;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark" id="menu-user-name">User</div>
                        <small class="text-muted" style="font-size:0.75rem">Quota: <span id="menu-quota" class="badge bg-secondary">0/5</span></small>
                    </div>
                </div>
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action border-0 py-3" onclick="goToAdminTab('create')"><i class="fas fa-plus-circle text-primary me-3"></i> Tạo mã mới</a>
                    <a href="#" class="list-group-item list-group-item-action border-0 py-3" onclick="goToAdminTab('list')"><i class="fas fa-list text-primary me-3"></i> Quản lý mã</a>
                    <a href="#" class="list-group-item list-group-item-action border-0 py-3" onclick="goToAdminTab('inbox')"><i class="fas fa-envelope text-primary me-3"></i> Hộp thư</a>
                    <div class="my-3 border-top"></div>
                    <a href="#" class="list-group-item list-group-item-action border-0 py-3 text-danger" id="btn-logout"><i class="fas fa-sign-out-alt me-3"></i> Đăng xuất</a>
                </div>
            </div>
        </div>
    </div>

    <header class="app-header">
        <div class="header-col-1">
            <button class="icon-btn" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="header-col-2">Thế Giới QR</div>
        <div class="header-col-3">
            <a href="index.html" class="icon-btn">
                <i class="fas fa-home"></i>
            </a>
        </div>
    </header>

    <main class="app-content">
        
        <div id="viewer-view" class="hidden">
            <div id="banner-container" class="banner-area">
                <a href="https://vdc.com.vn" target="_blank" class="w-100 h-100 text-decoration-none d-flex justify-content-center align-items-center bg-secondary text-white">
                     <img src="https://via.placeholder.com/800x400/4e54c8/ffffff?text=QUANG+CAO+HE+THONG" class="banner-img" alt="Quảng cáo">
                </a>
                <span class="badge bg-dark bg-opacity-50 position-absolute top-0 end-0 rounded-0" style="font-size: 0.6rem;">Ad</span>
            </div>

            <div id="limit-warning" class="hidden alert alert-danger m-3 text-center shadow-sm">
                <i class="fas fa-lock mb-2 d-block fa-2x"></i>
                <strong>Giới hạn truy cập!</strong><br>Mã QR này đã hết lượt quét miễn phí.
            </div>

            <div id="qr-content-active">
                <div class="qr-card shadow-sm">
                    <div class="mb-2 text-primary small fw-bold text-uppercase d-flex align-items-center">
                        <i class="fas fa-check-circle me-1"></i> Chia sẻ bởi: <span id="view-owner" class="ms-1 text-dark">...</span>
                    </div>
                    
                    <h1 id="view-title" class="qr-title">...</h1>
                    <div id="view-desc" class="qr-desc">...</div>

                    <a id="view-btn" href="#" class="action-btn btn-access" target="_blank">
                        <i class="fas fa-external-link-alt me-2"></i> TRUY CẬP NGAY
                    </a>
                    
                    <button class="action-btn btn-msg" data-bs-toggle="modal" data-bs-target="#contactModal">
                        <i class="fas fa-comment-dots me-2"></i> Nhắn tin cho tác giả
                    </button>
                </div>

                <div class="rating-area shadow-sm">
                    <p class="small text-muted mb-2 fw-bold">Đánh giá tài liệu này</p>
                    <div class="mb-2">
                        <i class="fas fa-star star-icon" onclick="rate(1)"></i>
                        <i class="fas fa-star star-icon" onclick="rate(2)"></i>
                        <i class="fas fa-star star-icon" onclick="rate(3)"></i>
                        <i class="fas fa-star star-icon" onclick="rate(4)"></i>
                        <i class="fas fa-star star-icon" onclick="rate(5)"></i>
                    </div>
                    <small id="rating-text" class="text-success fw-bold hidden">Cảm ơn bạn đã đánh giá!</small>
                </div>
            </div>
        </div>

        <div id="admin-container" class="admin-container hidden">
            <div id="auth-view" class="text-center mt-5 pt-5">
                <div class="mb-4 text-primary"><i class="fas fa-qrcode fa-4x"></i></div>
                <h3 class="fw-bold">Xin chào!</h3>
                <p class="text-muted mb-4">Đăng nhập để quản lý hệ thống</p>
                <button class="btn btn-dark py-3 px-5 rounded-pill shadow" id="btn-login-google">
                    <i class="fab fa-google me-2"></i> Tiếp tục với Google
                </button>
            </div>

            <div id="profile-view" class="hidden mt-4">
                <h4 class="mb-3">Cập nhật thông tin</h4>
                <form id="profile-form">
                    <div class="mb-3"><label>Tên hiển thị</label><input type="text" id="pro-name" class="form-control" required></div>
                    <div class="mb-3"><label>Số điện thoại</label><input type="tel" id="pro-phone" class="form-control" required></div>
                    <button class="btn btn-primary w-100 rounded-pill py-2">Lưu thông tin</button>
                </form>
            </div>

            <div id="dashboard-view" class="hidden">
                <div id="tab-create">
                    <h5 class="mb-3 text-primary"><i class="fas fa-magic me-2"></i>Tạo Mã Mới</h5>
                    <div class="card p-3 border-0 shadow-sm">
                        <input type="text" id="inp-title" class="form-control mb-3" placeholder="Tiêu đề tài liệu...">
                        <textarea id="inp-desc" class="form-control mb-3" rows="3" placeholder="Mô tả nội dung..."></textarea>
                        <input type="url" id="inp-link" class="form-control mb-3" placeholder="Link (https://)...">
                        <button class="btn btn-primary w-100 py-2 rounded-pill" onclick="createQR()">Tạo Ngay</button>
                    </div>
                    
                    <div id="result-area" class="hidden mt-4 text-center bg-white p-4 rounded shadow-sm border border-success">
                        <h6 class="text-success fw-bold">Tạo thành công!</h6>
                        <div id="qrcode-img" class="d-flex justify-content-center my-3"></div>
                        <button class="btn btn-sm btn-dark px-4 rounded-pill" onclick="downloadNewQR()">Tải ảnh QR</button>
                    </div>
                </div>

                <div id="tab-list" class="hidden">
                    <h5 class="mb-3 text-primary"><i class="fas fa-list me-2"></i>Quản lý mã</h5>
                    <div id="qr-list-container"></div>
                </div>

                <div id="tab-inbox" class="hidden">
                    <h5 class="mb-3 text-primary"><i class="fas fa-envelope me-2"></i>Hộp thư</h5>
                    <div id="inbox-container"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="app-footer">
        Copyright &copy; 2026 TheGioiQR.net
    </footer>

    <div class="modal fade" id="contactModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h6 class="modal-title">Nhắn tin</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="text" id="msg-sender" class="form-control mb-2" placeholder="Tên của bạn"><textarea id="msg-content" class="form-control" rows="3" placeholder="Nội dung..."></textarea></div><div class="modal-footer"><button class="btn btn-primary w-100" onclick="sendMsg()">Gửi tin</button></div></div></div></div>
    <div class="modal fade" id="editModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h6 class="modal-title">Sửa QR</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="edit-id"><input type="text" id="edit-title" class="form-control mb-2"><textarea id="edit-desc" class="form-control mb-2"></textarea><input type="url" id="edit-link" class="form-control"></div><div class="modal-footer"><button class="btn btn-primary w-100" onclick="saveEdit()">Lưu</button></div></div></div></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, addDoc, collection, query, where, getDocs, deleteDoc, orderBy, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyCzWjfcD5Dgq7V-i2izb9tKLR6QM6qWPQo", authDomain: "tavietnam-78ae8.firebaseapp.com", projectId: "tavietnam-78ae8", storageBucket: "tavietnam-78ae8.firebasestorage.app", messagingSenderId: "670121705534", appId: "1:670121705534:web:1027ad98550573ad37116f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser, userData, currentQrData = {};

        // MAIN INIT
        document.addEventListener('DOMContentLoaded', () => {
            const qrId = new URLSearchParams(window.location.search).get('id');
            if (qrId) {
                // Viewer Mode
                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('viewer-view').classList.remove('hidden');
                loadQrContent(qrId);
            } else {
                // Admin Mode
                document.getElementById('viewer-view').classList.add('hidden');
                document.getElementById('admin-container').classList.remove('hidden');
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        await syncUser(user);
                        updateSidebar(true);
                    } else {
                        document.getElementById('loading-overlay').classList.add('hidden');
                        document.getElementById('auth-view').classList.remove('hidden');
                        updateSidebar(false);
                    }
                });
            }
        });

        // VIEWER LOGIC
        async function loadQrContent(id) {
            try {
                const docRef = doc(db, "qr_codes", id);
                const snap = await getDoc(docRef);
                if (!snap.exists()) throw new Error("404");
                
                const d = snap.data();
                const views = d.views || 0;
                const limit = d.viewLimit || 100;
                
                currentQrData = { id: id, owner: d.createdBy, title: d.title };

                // Limit Check
                if (views >= limit) {
                    document.getElementById('qr-content-active').classList.add('hidden');
                    document.getElementById('limit-warning').classList.remove('hidden');
                    return;
                }

                updateDoc(docRef, { views: increment(1) });

                document.getElementById('view-title').innerText = d.title;
                document.getElementById('view-desc').innerText = d.desc;
                document.getElementById('view-owner').innerText = d.ownerName;
                document.getElementById('view-btn').href = d.link;

                const ownerSnap = await getDoc(doc(db, "users", d.createdBy));
                if (ownerSnap.exists() && ownerSnap.data().isVip) {
                    document.getElementById('banner-container').classList.add('vip-hide-banner');
                }

            } catch (e) {
                document.getElementById('view-title').innerText = "Mã QR không tồn tại";
                document.getElementById('view-btn').classList.add('hidden');
            }
        }

        // ADMIN LOGIC
        async function syncUser(user) {
            const ref = doc(db, "users", user.uid);
            const snap = await getDoc(ref);
            document.getElementById('loading-overlay').classList.add('hidden');
            document.getElementById('auth-view').classList.add('hidden');

            if (snap.exists()) {
                userData = snap.data();
                if (!userData.phone) document.getElementById('profile-view').classList.remove('hidden');
                else {
                    if (userData.lastDate !== new Date().toDateString()) await updateDoc(ref, { lastDate: new Date().toDateString(), dailyCount: 0 });
                    showDashboard();
                }
            } else document.getElementById('profile-view').classList.remove('hidden');
        }

        document.getElementById('profile-form').onsubmit = async (e) => {
            e.preventDefault();
            const newUser = { uid: currentUser.uid, email: currentUser.email, displayName: document.getElementById('pro-name').value, phone: document.getElementById('pro-phone').value, dailyLimit: 5, dailyCount: 0, lastDate: new Date().toDateString(), isVip: false, createdAt: new Date().toISOString() };
            await setDoc(doc(db, "users", currentUser.uid), newUser);
            userData = newUser;
            showDashboard();
        };

        function showDashboard() {
            document.getElementById('profile-view').classList.add('hidden');
            document.getElementById('dashboard-view').classList.remove('hidden');
            // Mặc định hiện tab create
            document.getElementById('tab-create').classList.remove('hidden');
        }

        function updateSidebar(isLoggedIn) {
            if(isLoggedIn) {
                document.getElementById('guest-menu').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                document.getElementById('menu-user-name').innerText = userData?.displayName || "User";
                document.getElementById('menu-quota').innerText = `${userData?.dailyCount||0}/${userData?.dailyLimit||5}`;
            } else {
                document.getElementById('guest-menu').classList.remove('hidden');
                document.getElementById('user-menu').classList.add('hidden');
            }
        }

        window.createQR = async () => {
            if ((userData.dailyCount || 0) >= userData.dailyLimit) return alert("Hết lượt tạo hôm nay!");
            const title = document.getElementById('inp-title').value;
            const link = document.getElementById('inp-link').value;
            if(!link) return alert("Thiếu link");

            document.getElementById('loading-overlay').classList.remove('hidden');
            try {
                const docRef = await addDoc(collection(db, "qr_codes"), {
                    title, desc: document.getElementById('inp-desc').value, link,
                    createdBy: currentUser.uid, ownerName: userData.displayName,
                    createdAt: new Date().toISOString(), views: 0, viewLimit: userData.isVip ? 999999 : 100
                });
                
                await updateDoc(doc(db, "users", currentUser.uid), { dailyCount: (userData.dailyCount||0)+1 });
                userData.dailyCount++;
                document.getElementById('menu-quota').innerText = `${userData.dailyCount}/${userData.dailyLimit}`;

                const url = `${window.location.origin}${window.location.pathname}?id=${docRef.id}`;
                document.getElementById('qrcode-img').innerHTML = "";
                new QRCode(document.getElementById('qrcode-img'), { text: url, width: 150, height: 150 });
                document.getElementById('result-area').classList.remove('hidden');
                document.getElementById('inp-title').value = ""; document.getElementById('inp-link').value = "";
            } catch(e) { alert(e.message); }
            finally { document.getElementById('loading-overlay').classList.add('hidden'); }
        }

        window.goToAdminTab = (tab) => {
            ['create', 'list', 'inbox'].forEach(t => document.getElementById(`tab-${t}`).classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu')).hide();
            if(tab === 'list') loadList();
            if(tab === 'inbox') loadInbox();
        }

        // List, Inbox, Edit, Delete (Compact)
        async function loadList() {
            const el = document.getElementById('qr-list-container'); el.innerHTML = "Đang tải...";
            const q = query(collection(db, "qr_codes"), where("createdBy", "==", currentUser.uid), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            el.innerHTML = snap.empty ? "<p class='text-muted text-center'>Trống</p>" : "";
            snap.forEach(d => { const r=d.data(); el.innerHTML+=`<div class="card mb-2 p-3 border-0 shadow-sm"><div class="d-flex justify-content-between align-items-center"><div><strong class="d-block text-truncate" style="max-width:150px">${r.title}</strong><span class="badge bg-light text-dark"><i class="fas fa-eye"></i> ${r.views}/${r.viewLimit}</span></div><div><button onclick="editQR('${d.id}')" class="btn btn-sm btn-light text-primary me-1"><i class="fas fa-edit"></i></button><button onclick="delQR('${d.id}')" class="btn btn-sm btn-light text-danger"><i class="fas fa-trash"></i></button></div></div></div>`; });
        }
        async function loadInbox() {
             const el = document.getElementById('inbox-container'); el.innerHTML = "Đang tải...";
             const q = query(collection(db, "messages"), where("toUid", "==", currentUser.uid), orderBy("createdAt", "desc"));
             const snap = await getDocs(q);
             el.innerHTML = snap.empty ? "<p class='text-muted text-center'>Trống</p>" : "";
             snap.forEach(d => { const m=d.data(); el.innerHTML+=`<div class="card mb-2 p-3 bg-light border-0"><strong>${m.senderName}</strong>: ${m.content}<br><small class="text-muted">Từ QR: ${m.qrTitle}</small></div>`; });
        }
        window.editQR = async(id)=>{const d=(await getDoc(doc(db,"qr_codes",id))).data();document.getElementById('edit-id').value=id;document.getElementById('edit-title').value=d.title;document.getElementById('edit-desc').value=d.desc;document.getElementById('edit-link').value=d.link;new bootstrap.Modal(document.getElementById('editModal')).show();}
        window.saveEdit=async()=>{await updateDoc(doc(db,"qr_codes",document.getElementById('edit-id').value),{title:document.getElementById('edit-title').value,desc:document.getElementById('edit-desc').value,link:document.getElementById('edit-link').value});alert("Lưu xong");location.reload();}
        window.delQR=async(id)=>{if(confirm("Xóa?")){await deleteDoc(doc(db,"qr_codes",id));loadList();}}
        
        window.rate = (s) => { document.querySelectorAll('.star-icon').forEach((i,x)=>i.classList.toggle('active',x<s)); document.getElementById('rating-text').classList.remove('hidden'); }
        window.sendMsg = async () => { if(!currentQrData.owner)return; await addDoc(collection(db, "messages"), { toUid: currentQrData.owner, senderName: document.getElementById('msg-sender').value, content: document.getElementById('msg-content').value, qrTitle: currentQrData.title, createdAt: new Date().toISOString() }); alert("Đã gửi tin!"); bootstrap.Modal.getInstance(document.getElementById('contactModal')).hide(); }
        window.showAuth = () => { bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu')).hide(); document.getElementById('viewer-view').classList.add('hidden'); document.getElementById('admin-container').classList.remove('hidden'); document.getElementById('auth-view').classList.remove('hidden'); }
        document.getElementById('btn-login-google').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('btn-logout').onclick = () => signOut(auth).then(()=>location.reload());
        window.downloadNewQR = () => { const a=document.createElement('a');a.download='QR.png';a.href=document.querySelector('#qrcode-img img').src;a.click(); };
    </script>
</body>
</html>
