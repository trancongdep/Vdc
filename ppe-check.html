<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC - WebAR PPE Check</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        model-viewer { width: 100vw; height: 100vh; background-color: #333; }

        /* Hotspot cảnh báo lỗi */
        .hotspot-warning {
            display: flex; align-items: center; gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px; border-radius: 30px;
            border: 2px solid #ef4444;
            font-weight: bold; color: #b91c1c; font-size: 14px;
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Hotspot khi đã sửa xong */
        .hotspot-success {
            background: #22c55e; color: white; border-color: white;
            animation: none;
        }
    </style>
</head>
<body>
    
    <model-viewer 
        id="ppe-model"
        src="https://modelviewer.dev/shared-assets/models/MaterialsVariantsShoe.glb" 
        ar ar-modes="webxr scene-viewer quick-look" 
        camera-controls shadow-intensity="1">

        <button class="hotspot-warning" slot="hotspot-issue" 
                data-position="-0.1 0.2 0.1" 
                data-normal="-0.7 0.5 0.5"
                onclick="fixPPE(this)">
            <span id="icon">⚠️</span>
            <span id="text">Lỗi: Dây chưa buộc</span>
        </button>

        <div class="fixed top-6 left-0 right-0 text-center pointer-events-none">
            <div class="bg-blue-900/80 text-white inline-block px-4 py-2 rounded-lg backdrop-blur">
                <h2 class="font-bold">BÀI TẬP PPE AR</h2>
                <p class="text-xs">Tìm và chạm vào các lỗi an toàn</p>
            </div>
        </div>

    </model-viewer>

    <script>
        const modelViewer = document.querySelector("#ppe-model");

        async function fixPPE(btnElement) {
            // 1. Đổi biến thể model (Ví dụ: Từ giày cũ sang giày mới, hoặc từ không mũ sang có mũ)
            // 'midnight' là tên biến thể có sẵn trong file mẫu này
            const names = modelViewer.availableVariants;
            modelViewer.variantName = 'midnight'; 

            // 2. Hiệu ứng giao diện (UI)
            btnElement.classList.replace("hotspot-warning", "hotspot-success");
            btnElement.querySelector("#icon").innerText = "✅";
            btnElement.querySelector("#text").innerText = "Đã khắc phục!";
            
            // 3. Thông báo hoàn thành
            setTimeout(() => {
                alert("Xuất sắc! Bạn đã phát hiện và xử lý lỗi PPE.");
            }, 500);
        }
    </script>
</body>
</html>
